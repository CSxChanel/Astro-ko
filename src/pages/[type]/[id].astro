---
import Layout from "../../layouts/Layout.astro"
const {
	type,
	id
} = Astro.params;
const apiKey = import.meta.env.APP_APIKEY;
const baseUrl = import.meta.env.APP_BASEURL;

let mediaDetails = {};

try {
	const response = await fetch(
		`${baseUrl}/${type}/${id}?language=en-US&api_key=${apiKey}`
	);
	mediaDetails = await response.json();

} catch (error) {
	console.error('Error fetching media details:', error);
}
---

<Layout title={mediaDetails.title || 'Detail'}
	description={mediaDetails.overview}
	media="Movie-detail"
	movie={mediaDetails.backdrop_path}>
	<main class="h-screen bg-lime-700">
		<div class="relative">
			<img
			class="w-full h-[300px] md:h-auto object-cover object-center"
			src={`https://image.tmdb.org/t/p/w500${mediaDetails.backdrop_path}`}
			alt={mediaDetails.title}
			style={ {
				maskImage:
				"linear-gradient(to bottom, rgba(0, 0, 0, 1) 60%, transparent 100%)",
				WebkitMaskImage:
				"linear-gradient(to bottom, rgba(0, 0, 0, 1) 60%, transparent 100%)"
			}}
			/>
	</div>
	<div class="container flex">
		<img
		class="mr-5 z-20 md:-my-36 -my-24 mb-14 md:mb-20 w-[45%] md:w-[50%] h-auto md:h-auto object-cover object-center border-2 rounded-2xl"
		src={`https://image.tmdb.org/t/p/w500${mediaDetails.poster_path}`}
		alt={mediaDetails.title}
		/>
	<div class="flex-col">
		<h1 class="font-primary font-semibold md:font-bold text-xl md:text-5xl md: md:my-10 my-2">
			{mediaDetails.title}
		</h1>
		<div class="font-bold md:text-5xl flex">
			Genres &nbsp;
			<ul class="list-disc list-inside">
				{mediaDetails.genres.map(genre => (
					<li key={genre.id }>{genre.name
				}</li>
			))}
	</ul>
</div>
</div>
</div>

<div class="container">
<p class="font-bold md:text-2xl my-2">
Release Date :
<span class="bg-slate-700 px-2 rounded-xl">
{mediaDetails.release_date}
</span>
</p>

<p class="font-bold md:text-2xl my-2">
Status :{" "}
<span class="bg-slate-700 px-2 rounded-xl">
{mediaDetails.status}
</span>
</p>
<p class="font-bold md:text-2xl my-2">
Production_Countries :{" "}
<span class="bg-slate-700 px-2 rounded-xl">
{mediaDetails.production_countries
.map(country => country.name)
.join(", ")}
</span>
</p>
<p class="mb-2 font-bold md:text-2xl">
Overview :{" "}
<span class="bg-slate-700 px-2 rounded-xl text-sm md:text-xl">
{mediaDetails.overview}
</span>
</p>

</div>
</main>
</Layout>